# План исправления миграции моделей

## Проблемы текущей миграции

1. **Переносятся только контексты моделей** - не переносятся:
   - Переменные моделей (`modelVariables`)
   - Функции моделей (`modelFunctions`)
   - События моделей (`modelEvents`)
   - Привязки (`bindings`)
   - Наборы правил (`ruleSets`)
   - Тип модели (абсолютная, относительная, экземплярная)

2. **Не переносятся группы контекстов** - все контексты создаются в кучу без разделения на группы

3. **Не учитывается тип модели** - все модели создаются как обычные контексты без указания типа

## Решение

### 1. Получение информации о модели

Для каждой модели нужно получить:
- **Тип модели**: из переменной `model` (поле `type`):
  - `0` = TYPE_RELATIVE (относительная)
  - `1` = TYPE_ABSOLUTE (абсолютная)
  - `2` = TYPE_INSTANTIABLE (экземплярная)
- **Переменные модели**: из переменной `modelVariables`
- **Функции модели**: из переменной `modelFunctions`
- **События модели**: из переменной `modelEvents`
- **Привязки**: из переменной `bindings`
- **Наборы правил**: из переменной `ruleSets`
- **Группа контекста**: из метода `getGroup()` или переменной `childInfo`

### 2. Получение информации о группах

Группы контекстов находятся в специальных контекстах:
- `users.{username}.models_groups.{groupName}` - группы моделей
- `users.{username}.devices_groups.{groupName}` - группы устройств
- `users.{username}.widgets_groups.{groupName}` - группы виджетов
- `users.{username}.dashboards_groups.{groupName}` - группы дашбордов

Нужно:
1. Получить список всех групп для каждого типа контекста
2. Создать группы на целевом сервере
3. При создании контекстов указывать их группу

### 3. Правильное создание моделей

Модели нужно создавать с указанием типа через переменную `model`:
- Для абсолютной модели: `type = 1`
- Для относительной модели: `type = 0`
- Для экземплярной модели: `type = 2`

### 4. Перенос компонентов модели

После создания модели нужно:
1. Установить переменную `modelVariables` со всеми переменными
2. Установить переменную `modelFunctions` со всеми функциями
3. Установить переменную `modelEvents` со всеми событиями
4. Установить переменную `bindings` со всеми привязками
5. Установить переменную `ruleSets` со всеми наборами правил

## План действий

1. ✅ Изучить структуру моделей и групп
2. ⏳ Создать функцию для получения полной информации о модели
3. ⏳ Создать функцию для получения информации о группах
4. ⏳ Создать функцию для правильного создания модели с типом
5. ⏳ Создать функцию для переноса всех компонентов модели
6. ⏳ Пересоздать все модели с правильной структурой
7. ⏳ Создать группы и переместить контексты в группы

