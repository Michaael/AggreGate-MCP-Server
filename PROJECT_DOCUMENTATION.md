# Документация проекта AggreGate

**Сервер:** 91.240.87.214  
**Пользователь:** admin  
**Дата анализа:** 2025-01-27

---

## Оглавление

1. [Обзор проекта](#обзор-проекта)
2. [Архитектура системы](#архитектура-системы)
3. [Основные компоненты](#основные-компоненты)
4. [Модели данных](#модели-данных)
5. [Устройства](#устройства)
6. [Визуализация и интерфейсы](#визуализация-и-интерфейсы)
7. [Пользователи и права доступа](#пользователи-и-права-доступа)
8. [Функциональные модули](#функциональные-модули)
9. [Интеграции](#интеграции)
10. [Технические детали](#технические-детали)

---

## Обзор проекта

Данный проект представляет собой комплексную систему управления инженерными системами зданий и инфраструктурой на платформе **Tibbo AggreGate**. Система обеспечивает мониторинг, управление и автоматизацию различных инженерных систем, включая:

- Системы отопления и теплоснабжения
- Водоснабжение (холодная и горячая вода)
- Газоснабжение
- Электроснабжение
- Вентиляция и кондиционирование
- Пожарная сигнализация
- Системы контроля доступа (SCUD)
- IT-инфраструктура
- Видеонаблюдение
- Лифтовое оборудование

### Масштаб проекта

- **100+ моделей** для различных типов оборудования и систем
- **10 устройств** для подключения к внешним системам
- **20+ виджетов** для визуализации данных
- **200+ дашбордов** для управления и мониторинга
- **11 пользователей** с различными уровнями доступа

---

## Архитектура системы

### Иерархическая структура контекстов

Проект организован по стандартной иерархии AggreGate:

```
users/
  admin/
    models/          # Бизнес-логика и модели данных
    devices/         # Устройства для подключения
    widgets/         # UI компоненты
    dashboards/      # Панели управления
    alerts/          # Системы уведомлений
    queries/         # SQL запросы
    jobs/            # Планировщик заданий
    workflows/       # Рабочие процессы
    scripts/         # Скрипты
    reports/         # Отчеты
```

### Основные принципы архитектуры

1. **Модельно-ориентированный подход**: Каждый тип оборудования представлен отдельной моделью
2. **Иерархическая организация**: Объекты организованы в иерархические структуры
3. **Модульность**: Функциональность разделена на независимые модули
4. **Расширяемость**: Система легко расширяется новыми типами оборудования

---

## Основные компоненты

### 1. Модели данных (Models)

Модели представляют бизнес-логику и структуры данных для различных типов оборудования и систем.

#### Категории моделей:

**Инженерные системы:**
- `pump` - Насосы
- `pumpStation` - Насосные станции
- `pumpUnit` - Насосные агрегаты
- `ventilation` - Вентиляция
- `ventilationSystem` - Системы вентиляции
- `compressorUnit` - Компрессорные установки
- `compressUnit` - Компрессорные агрегаты
- `frozenUnit` - Холодильные установки
- `condensator` - Конденсаторы
- `hydroaccumulator` - Гидроаккумуляторы

**Системы безопасности:**
- `fireAlarm` - Пожарная сигнализация
- `fire` - Пожарные системы
- `smoke` - Дымовые датчики
- `siren` - Сирены оповещения
- `controlAccess` - Контроль доступа
- `SCUD` - Система контроля и управления доступом

**Системы мониторинга:**
- `sensor` - Датчики
- `temperatureSensor` - Датчики температуры
- `pressureGauge` - Манометры
- `pressureSwitch` - Реле давления
- `termal` - Тепловые системы
- `termo` - Терморегуляторы
- `ThermalPoint` - Тепловые точки

**Счетчики и учет:**
- `meters` - Счетчики (общая модель)
- `coldWaterMeters1` - Счетчики холодной воды
- `hotWaterMeters` - Счетчики горячей воды
- `electrMeters` - Электросчетчики
- `gazMeters` - Газовые счетчики
- `absoluteMeter` - Абсолютные счетчики
- `guideMeter` - Справочник счетчиков

**IT-инфраструктура:**
- `IT` - IT инфраструктура
- `servers` - Серверы
- `serversAbsolute` - Серверы (абсолютные)
- `networkDevice` - Сетевые устройства
- `itServices` - IT сервисы
- `applicationServ` - Серверы приложений
- `graphITinfrastructure` - График IT инфраструктуры

**Управление объектами:**
- `objects` - Объекты (здания, помещения)
- `abonent` - Абоненты
- `personnel` - Персонал
- `fio` - ФИО

**Визуализация:**
- `graphics` - Графика
- `graphApplication` - График приложений
- `graphEngineer` - График инженерных систем
- `video` - Видеонаблюдение

**Специализированные системы:**
- `TRV1`, `TRV2` - Терморегулирующие вентили
- `blind` - Жалюзи
- `combo` - Комбинированные системы
- `control` - Системы управления
- `datalift` - Данные лифтов

**Имитаторы и тестирование:**
- `dataColdImitator` - Имитатор холодной воды
- `dataHotImitator` - Имитатор горячей воды
- `dataElectrImitator` - Имитатор электроэнергии
- `dataGazImitator` - Имитатор газа
- `gpTestImitator` - Имитатор для тестирования

**Интеграции:**
- `bff_Lims`, `bffLimsN` - Backend для LIMS
- `worker_Lims`, `workerLimsN` - Рабочие процессы LIMS
- `restAPI` - REST API
- `restArena` - REST Arena
- `stomp` - STOMP протокол
- `telegramConnector` - Интеграция с Telegram

**Вспомогательные модели:**
- `devices` - Устройства (общая модель)
- `system` - Системные настройки
- `frontendConfig` - Конфигурация фронтенда
- `geocoding` - Геокодирование
- `barQrCodeCreater` - Генератор штрих-кодов
- `barQrCodePresentator` - Презентатор штрих-кодов
- `fileManagerAgent` - Агент управления файлами
- `deviceImages` - Изображения устройств

**Логирование:**
- `imLogCommon` - Общий лог имитаторов
- `imLogAccess` - Лог доступа
- `imLogEnergy` - Лог энергетики
- `imLogFireControl` - Лог пожарного контроля
- `imLogIT1-4` - Логи IT систем
- `imLogLifts` - Лог лифтов
- `imLogPumpControl` - Лог управления насосами
- `imLogRefrigerators` - Лог холодильников
- `imLogSewerage` - Лог канализации
- `imLogTermal` - Лог тепловых систем
- `imLogVent` - Лог вентиляции
- `imLogVideo` - Лог видеонаблюдения

**Устройства имитаторов:**
- `imDevAccess` - Имитатор устройств доступа
- `imDevElectroCounter` - Имитатор электросчетчиков
- `imDevFire` - Имитатор пожарной сигнализации
- `imDevIT1` - Имитатор IT устройств
- `imDevPump` - Имитатор насосов
- `imDevVent` - Имитатор вентиляции
- `imDevWarmCounter` - Имитатор счетчиков тепла
- `imDevWaterCounter` - Имитатор счетчиков воды

**Специализированные модели:**
- `KPIInfo` - Информация о KPI
- `MassAndVolumeOfPetroleumProducts` - Масса и объем нефтепродуктов
- `MassAndVolumeOfPetroleumProductsLinux` - Масса и объем нефтепродуктов (Linux)
- `AbslModelStrijRawData` - Модель сырых данных
- `serviceModel` - Сервисная модель
- `import_meters` - Импорт счетчиков
- `dataClient` - Клиентские данные
- `detailsForHost` - Детали для хоста

### 2. Устройства (Devices)

Устройства обеспечивают подключение к внешним системам и источникам данных:

1. **dataCenterManagementDevice1** - Устройство управления дата-центром 1 (Virtual)
2. **dataCenterManagementDevice2** - Устройство управления дата-центром 2 (Virtual)
3. **geo** - Геосервисы (HTTP)
4. **nameFemale** - Генератор женских имен (File)
5. **nameGenerator** - Генератор имен (HTTP)
6. **nameMale** - Генератор мужских имен (File)
7. **randomizer_Lims** - Рандомизатор для LIMS (Virtual)
8. **surname** - Генератор фамилий (File)
9. **telegram** - Интеграция с Telegram (HTTP)
10. **virtual** - Виртуальное устройство (Virtual)

### 3. Виджеты (Widgets)

Виджеты предоставляют UI компоненты для отображения данных:

- `devices` - Виджет устройств
- `reports` - Виджет отчетов
- `events` - Виджет событий
- `mainMenu` - Главное меню
- `logo` - Логотип
- `meters` - Виджет счетчиков
- `meterInfo` - Информация о счетчике
- `objects` - Виджет объектов
- `object` - Виджет объекта (Chart)
- `fileManager` - Файловый менеджер
- `fileCommander` - Файловый командир
- `gatewayMap` - Карта шлюзов
- `maint` - Виджет обслуживания
- `periodPanel` - Панель выбора периода
- `vendor` - Виджет поставщика
- `MegafonZKH` - Виджет Мегафон ЖКХ

### 4. Дашборды (Dashboards)

Дашборды организуют интерфейсы для различных задач:

#### Основные дашборды:
- `mainScreenArena` - Главный экран Arena
- `mainScreenArenaMobile` - Главный экран Arena (мобильная версия)
- `mainMenu` - Главное меню
- `mainWindow` - Главное окно
- `mainWindowArena` - Главное окно Arena

#### Мониторинг и визуализация:
- `monitoring` - Мониторинг
- `monitoring_IT` - Мониторинг IT
- `summary_info` - Сводная информация
- `summary_information` - Сводная информация (расширенная)
- `info` - Информация
- `info_chart` - Информационный график
- `info_chart_IT` - Информационный график IT

#### Управление устройствами:
- `menu_device` - Меню устройств
- `menu_device_electr` - Меню электроустройств
- `menu_device_fireAlarm` - Меню пожарной сигнализации
- `menu_device_pump` - Меню насосов
- `menu_device_vent` - Меню вентиляции
- `dataDevices` - Данные устройств
- `dataDeviceElectr` - Данные электроустройств
- `devicesInventory` - Инвентаризация устройств
- `invDevices` - Инвентаризация устройств (альтернативная)

#### Схемы и графики:
- `chart_device` - График устройства
- `chart_device_fire` - График пожарной системы
- `chart_device_pump` - График насосов
- `bargraph_device` - Столбчатый график устройства
- `bargraph_device_fireAlarm` - Столбчатый график пожарной сигнализации
- `bargraph_device_pump` - Столбчатый график насосов
- `bargraph_device_vent` - Столбчатый график вентиляции
- `map_device` - Карта устройств
- `map_device_electr` - Карта электроустройств
- `map_device_fireAlarm` - Карта пожарной сигнализации
- `map_device_pump` - Карта насосов
- `map_device_vent` - Карта вентиляции

#### Специализированные системы:
- `fireAlarm_scheme` - Схема пожарной сигнализации
- `pump_station_scheme` - Схема насосной станции
- `vent_system_scheme` - Схема системы вентиляции
- `cooling_supply_scheme` - Схема системы охлаждения
- `device_fire_alarm` - Устройство пожарной сигнализации
- `device_pump_station` - Устройство насосной станции
- `ventilation_system` - Система вентиляции
- `compressor_unit_device` - Устройство компрессорной установки
- `device_compressor` - Устройство компрессора
- `device_compressor_unit` - Устройство компрессорной установки

#### Управление объектами:
- `objects` - Объекты
- `coldWaterObject` - Объект холодной воды
- `hotWaterObject` - Объект горячей воды
- `electrObject` - Электрообъект
- `gazObject` - Газовый объект

#### SCUD (Система контроля и управления доступом):
- `SCUDMain` - Главный экран SCUD
- `SCUDUsers` - Пользователи SCUD
- `SCUDRole` - Роли SCUD
- `SCUD_device` - Устройства SCUD
- `graphicCSUD` - График SCUD
- `graphic_state_SCUD` - График состояния SCUD
- `bargraph_SCUD_device` - Столбчатый график устройств SCUD
- `chart_SCUD_device` - График устройств SCUD
- `map_SCUD_device` - Карта устройств SCUD
- `menu_SCUD_device` - Меню устройств SCUD
- `log_SCUD_event` - Лог событий SCUD

#### Приложения и заявки:
- `applications_main` - Главный экран приложений
- `applications_in_work` - Приложения в работе
- `applications_done` - Выполненные приложения
- `createApplication` - Создание заявки
- `create_applications` - Создание приложений
- `queueApplication` - Очередь заявок
- `queue_applications` - Очередь приложений
- `closedApplication` - Закрытые заявки
- `applicationAtWork` - Приложение в работе
- `applicationMobile` - Мобильное приложение
- `applicationReport` - Отчет по приложениям

#### Отчеты:
- `reports` - Отчеты
- `equipmentReport` - Отчет по оборудованию
- `shiftReport` - Отчет по смене/обслуживанию

#### Администрирование:
- `administration` - Администрирование
- `administr` - Администрирование (альтернативное)
- `administrationArena` - Администрирование Arena
- `users` - Пользователи
- `roles` - Роли
- `systemInfo` - Информация о системе

#### KPI и аналитика:
- `KPI` - KPI показатели
- `KPI_IT` - KPI IT
- `mainIT` - Главный экран IT

#### Специализированные дашборды:
- `accessControlSystems` - Системы контроля доступа
- `videoControl` - Управление видео
- `videoControlSystems` - Системы видеоконтроля
- `elevator_registry` - Реестр лифтов
- `vertical_lift_monitoring` - Мониторинг лифтов
- `employeeList` - Список сотрудников
- `dataEmployee` - Данные сотрудников
- `hausesAndCommunalServices` - Дома и коммунальные услуги

#### 3D визуализация:
- `3DVisual` - 3D визуализация
- `3D_visual` - 3D визуализация (альтернативная)
- `test3D` - Тест 3D

#### Руководства и документация:
- `connectivityGuide` - Руководство по подключению
- `integrationGuide` - Руководство по интеграции
- `iotGuide` - Руководство по IoT
- `managementGuide` - Руководство по управлению
- `securityGuide` - Руководство по безопасности
- `storageGuide` - Руководство по хранению
- `visualizationGuide` - Руководство по визуализации

#### Технические дашборды:
- `contextContainer` - Контейнер контекстов
- `customEventLog` - Пользовательский журнал событий
- `network` - Сеть
- `servers` - Серверы
- `services` - Сервисы
- `stations` - Станции
- `stomp` - STOMP

---

## Модели данных

### Модель объектов (objects)

Модель для управления объектами недвижимости (здания, помещения):

**Основные переменные:**
- `abonent` - Абоненты (таблица с полями: id, surname, name, patronimyc, pasportSerial, pasportNumber)
- `flat` - Квартиры
- `guideFlat` - Справочник квартир
- `guideAbonent` - Справочник абонентов
- `granulator` - Гранулятор

**Функции:**
- `setAbonent` - Установка абонента
- `storageOpen`, `storageClose`, `storageGet`, `storageUpdate`, `storageDelete`, `storageInsert` - Работа с хранилищем
- `granulate` - Грануляция данных

### Модель счетчиков (meters)

Модель для управления счетчиками различных ресурсов:

**Типы счетчиков:**
- Холодная вода (`coldWaterMeters1`)
- Горячая вода (`hotWaterMeters`)
- Электроэнергия (`electrMeters`)
- Газ (`gazMeters`)
- Тепло (`imDevWarmCounter`)

### Модель устройств (devices)

Модель для управления устройствами:

**Основные переменные:**
- `application` - Приложение на устройстве
- `marker` - Маркер на карте
- `ventilation` - Вентиляционная система
- `create` - Создание устройства
- `id` - Идентификатор
- `appFlag` - Флаг приложения
- `menu` - Меню устройства
- `termalPoint` - Тепловая точка
- `compressor` - Компрессорная установка

---

## Устройства

### Виртуальные устройства

Используются для тестирования и имитации работы реальных систем:

- **dataCenterManagementDevice1/2** - Имитация систем управления дата-центром
- **virtual** - Универсальное виртуальное устройство
- **randomizer_Lims** - Генератор случайных данных для LIMS

### HTTP устройства

Обеспечивают интеграцию с внешними сервисами:

- **geo** - Геосервисы (геокодирование, карты)
- **nameGenerator** - Генератор имен через HTTP API
- **telegram** - Интеграция с Telegram Bot API

### Файловые устройства

Работают с локальными файлами:

- **nameFemale** - Файл с женскими именами
- **nameMale** - Файл с мужскими именами
- **surname** - Файл с фамилиями

---

## Визуализация и интерфейсы

### Типы визуализации

1. **Карты (Maps)** - Отображение устройств на карте
2. **Графики (Charts)** - Временные ряды данных
3. **Столбчатые графики (Bargraphs)** - Сравнительная статистика
4. **Схемы (Schemes)** - Схемы инженерных систем
5. **3D визуализация** - Трехмерное представление объектов

### Адаптивность

Система поддерживает:
- Десктопные интерфейсы
- Мобильные интерфейсы (`mainScreenArenaMobile`, `applicationMobile`)
- Адаптивные дашборды (`adaptive`)

---

## Пользователи и права доступа

### Список пользователей

1. **admin** - Администратор (основной пользователь)
2. **admin1** - Администратор 1
3. **adminLims** - Администратор LIMS
4. **adminMonitoring** - Администратор мониторинга
5. **demo** - Демо пользователь
6. **operator** - Оператор
7. **operator2** - Оператор 2
8. **operator3** - Оператор 3
9. **testUser1** - Тестовый пользователь 1
10. **user1** - Пользователь 1
11. **NewUser** - Новый пользователь

### Уровни доступа

Система использует стандартные уровни доступа AggreGate:
- **observer** - Наблюдатель (только чтение)
- **operator** - Оператор (базовые операции)
- **manager** - Менеджер (управление)
- **engineer** - Инженер (инженерные операции)
- **admin** - Администратор (полный доступ)

---

## Функциональные модули

### 1. Система управления объектами

Управление зданиями, помещениями, квартирами и абонентами:
- Реестр объектов
- Привязка оборудования к объектам
- Управление абонентами
- Геокодирование и картография

### 2. Система учета ресурсов

Мониторинг и учет потребления ресурсов:
- Счетчики воды (холодная/горячая)
- Счетчики электроэнергии
- Счетчики газа
- Счетчики тепла
- Аналитика потребления

### 3. Инженерные системы

Управление инженерными системами зданий:
- Насосные станции
- Системы вентиляции
- Компрессорные установки
- Холодильные системы
- Тепловые системы

### 4. Системы безопасности

Мониторинг и управление системами безопасности:
- Пожарная сигнализация
- Системы контроля доступа (SCUD)
- Видеонаблюдение
- Оповещение

### 5. IT-инфраструктура

Мониторинг IT-систем:
- Серверы
- Сетевые устройства
- IT-сервисы
- Приложения

### 6. Система заявок и обслуживания

Управление заявками на обслуживание:
- Создание заявок
- Очередь заявок
- Отслеживание выполнения
- Отчеты по обслуживанию

### 7. Система отчетности

Генерация отчетов:
- Отчеты по оборудованию
- Отчеты по сменам
- KPI показатели
- Аналитические отчеты

---

## Интеграции

### 1. LIMS (Laboratory Information Management System)

Интеграция с лабораторной информационной системой:
- Модели: `bff_Lims`, `bffLimsN`, `worker_Lims`, `workerLimsN`
- Устройство: `randomizer_Lims`
- Обмен данными с лабораторными системами

### 2. REST API

Предоставление API для внешних систем:
- `restAPI` - Основной REST API
- `restArena` - REST API для Arena

### 3. Telegram

Интеграция с Telegram:
- Устройство `telegram` для отправки уведомлений
- Модель `telegramConnector` для управления интеграцией

### 4. STOMP

Поддержка протокола STOMP для обмена сообщениями:
- Модель `stomp`
- Дашборд `stomp`

### 5. Геосервисы

Интеграция с геосервисами:
- Устройство `geo` (HTTP)
- Модель `geocoding`
- Картографические дашборды

---

## Технические детали

### Платформа

- **AggreGate Server** версии 6.34.06 или выше
- **Java 8+** для выполнения кода
- **Иерархическая структура контекстов** для организации данных

### Хранение данных

- **База данных** - основное хранилище (storageMode: 0)
- **Память** - для временных данных (storageMode: 1)
- **История изменений** - для отслеживания изменений переменных

### Производительность

- **Пул потоков** - для параллельной обработки
- **Кэширование** - для оптимизации доступа к данным
- **Периодические обновления** - через привязки (bindings)

### Безопасность

- **Многоуровневая система прав доступа**
- **Аутентификация пользователей**
- **Шифрование соединений**
- **Аудит действий**

### Масштабируемость

- **Модульная архитектура** - легко добавлять новые модули
- **Иерархическая организация** - поддержка больших объемов данных
- **Распределенная архитектура** - возможность распределения нагрузки

---

## Рекомендации по использованию

### Для администраторов

1. Регулярно проверяйте статус устройств через дашборды мониторинга
2. Используйте систему отчетов для анализа работы систем
3. Настройте алерты для критических событий
4. Регулярно обновляйте справочники объектов и оборудования

### Для операторов

1. Используйте мобильные интерфейсы для работы в поле
2. Создавайте заявки на обслуживание через систему заявок
3. Отслеживайте события через журналы событий
4. Используйте карты для визуализации расположения оборудования

### Для разработчиков

1. Следуйте принципам модульности при создании новых моделей
2. Используйте стандартные шаблоны для виджетов и дашбордов
3. Документируйте создаваемые функции и переменные
4. Тестируйте новые компоненты на виртуальных устройствах

---

## Заключение

Данный проект представляет собой комплексную систему управления инженерными системами зданий на платформе AggreGate. Система обеспечивает:

- ✅ Мониторинг всех инженерных систем
- ✅ Управление объектами и оборудованием
- ✅ Учет потребления ресурсов
- ✅ Системы безопасности и контроля доступа
- ✅ Интеграцию с внешними системами
- ✅ Гибкую систему отчетности
- ✅ Масштабируемую архитектуру

Система готова к использованию и может быть расширена новыми модулями и функциональностью по мере необходимости.

---

**Версия документации:** 1.0  
**Дата создания:** 2025-01-27  
**Автор:** AI Assistant (на основе анализа сервера AggreGate)

