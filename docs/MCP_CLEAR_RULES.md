# –ß–µ—Ç–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è MCP —Å–µ—Ä–≤–µ—Ä–∞ AggreGate

## üéØ –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ: –ö–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

#### ‚úÖ –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `aggregate_set_variable_field` –¥–ª—è:
- –ü—Ä–æ—Å—Ç—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å –æ–¥–Ω–∏–º –ø–æ–ª–µ–º: `<temperature><E>`, `<status><S>`, `<count><I>`
- **–í–°–ï–• –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ –º–æ–¥–µ–ª—è—Ö** (–¥–∞–∂–µ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–ª—è–º–∏) - –º–æ–¥–µ–ª–∏ —Å–æ–∑–¥–∞—é—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å maxRecords=1
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å maxRecords=1

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "tool": "aggregate_set_variable_field",
  "parameters": {
    "path": "users.admin.models.sensor",
    "variableName": "temperature",  // ‚ö†Ô∏è variableName, –Ω–µ name!
    "fieldName": "temperature",
    "value": 25.5
  }
}
```

#### ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `aggregate_set_variable` —Ç–æ–ª—å–∫–æ –¥–ª—è:
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å maxRecords > 1 (–Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π)
- **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ maxRecords —á–µ—Ä–µ–∑ `aggregate_get_variable` –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º**

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –í –º–æ–¥–µ–ª—è—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å maxRecords=1 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –¥–∞–∂–µ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–ª—è–º–∏!

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–ª—è–º–∏ –≤ –º–æ–¥–µ–ª—è—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `<temperature><E><humidity><E><timestamp><L>` –≤ –º–æ–¥–µ–ª–∏ –∏–º–µ–µ—Ç maxRecords=1

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `aggregate_set_variable_field` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è –æ—Ç–¥–µ–ª—å–Ω–æ:

```json
// –ü–æ–ª–µ 1
{"tool": "aggregate_set_variable_field", "parameters": {"path": "...", "variableName": "sensor_data", "fieldName": "temperature", "value": 25.5}}

// –ü–æ–ª–µ 2
{"tool": "aggregate_set_variable_field", "parameters": {"path": "...", "variableName": "sensor_data", "fieldName": "humidity", "value": 60.0}}

// –ü–æ–ª–µ 3
{"tool": "aggregate_set_variable_field", "parameters": {"path": "...", "variableName": "sensor_data", "fieldName": "timestamp", "value": 1234567890}}
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç –≤—ã–±–æ—Ä–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏–π

```
–ù—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π?
‚îÇ
‚îú‚îÄ –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –≤ –º–æ–¥–µ–ª–∏? ‚Üí –î–ê ‚Üí aggregate_set_variable_field (–¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è)
‚îÇ
‚îú‚îÄ –ü—Ä–æ—Å—Ç–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è (<name><T>)? ‚Üí –î–ê ‚Üí aggregate_set_variable_field
‚îÇ
‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ maxRecords —á–µ—Ä–µ–∑ get_variable? ‚Üí maxRecords=1 ‚Üí aggregate_set_variable_field
‚îÇ
‚îî‚îÄ maxRecords > 1? ‚Üí –î–ê ‚Üí aggregate_set_variable
```

## üîß Expression —Ñ—É–Ω–∫—Ü–∏–∏

### –°–æ–∑–¥–∞–Ω–∏–µ Expression —Ñ—É–Ω–∫—Ü–∏–∏

**–ü—Ä–∞–≤–∏–ª–∞:**
1. `inputFormat` –∏ `outputFormat` –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö - **–ë–ï–ó** `<<>>`
   - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: `<value1><E><value2><E>`
   - ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: `<<value1><E>>`

2. –î–≤–æ–π–Ω—ã–µ —Å–∫–æ–±–∫–∏ `<<>>` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è**
   - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: `table("<<result><E>>", ({value1} + {value2}) / 2)`

3. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `aggregate_list_functions` –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "tool": "aggregate_create_function",
  "parameters": {
    "path": "users.admin.models.calculator",
    "functionName": "calculate_average",
    "functionType": 1,
    "inputFormat": "<value1><E><value2><E>",  // –ë–ï–ó <<>>
    "outputFormat": "<result><E>",            // –ë–ï–ó <<>>
    "expression": "table(\"<<result><E>>\", ({value1} + {value2}) / 2)"  // –° <<>>
  }
}
```

### –í—ã–∑–æ–≤ Expression —Ñ—É–Ω–∫—Ü–∏–∏

**–§–æ—Ä–º–∞—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
- –ü—Ä–æ—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç: `{"value1": 10.5, "value2": 20.3}`
- DataTable —Ñ–æ—Ä–º–∞—Ç: `{"records": [{"value1": 10.5, "value2": 20.3}]}`

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç –∏ –ø–æ–ª—É—á–∞–µ—Ç inputFormat –∏–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏.

## ü§ñ –†–∞–±–æ—Ç–∞ —Å –∞–≥–µ–Ω—Ç–∞–º–∏

### –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞

**–ü—Ä–∞–≤–∏–ª–∞:**
1. –°–æ–∑–¥–∞–π—Ç–µ –∞–≥–µ–Ω—Ç–∞: `aggregate_create_agent`
2. **–ü–æ–¥–æ–∂–¥–∏—Ç–µ 2-3 —Å–µ–∫—É–Ω–¥—ã** –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–±—ã—Ç–∏–µ: `aggregate_fire_event`
   - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∂–¥–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–æ 5 —Å–µ–∫—É–Ω–¥
   - –ï—Å–ª–∏ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è, –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ —á–µ—Ä–µ–∑ 2-3 —Å–µ–∫—É–Ω–¥—ã

**–ü—Ä–∏–º–µ—Ä:**
```json
// 1. –°–æ–∑–¥–∞–Ω–∏–µ
{"tool": "aggregate_create_agent", "parameters": {"agentName": "my_agent", ...}}

// 2. –û–ñ–ò–î–ê–ù–ò–ï (–≤ –∫–æ–¥–µ: time.sleep(3))

// 3. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è
{"tool": "aggregate_fire_event", "parameters": {"agentName": "my_agent", "eventName": "test", ...}}
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤

### –û—à–∏–±–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ü—Ä–∞–≤–∏–ª–æ:** –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ –æ—à–∏–±–∫—É –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏:
1. **–ù–ï –ø–∞–Ω–∏–∫—É–π—Ç–µ** - —ç–ª–µ–º–µ–Ω—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ list —Ñ—É–Ω–∫—Ü–∏–∏:
   - `aggregate_list_variables` –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
   - `aggregate_list_functions` –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π
   - `aggregate_get_variable` –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
3. –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–∞–π–¥–µ–Ω - –∏–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ –æ—à–∏–±–∫—É –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
4. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω - –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ —á–µ—Ä–µ–∑ 1-2 —Å–µ–∫—É–Ω–¥—ã

## üö´ –ß–µ–≥–æ –ù–ï –¥–µ–ª–∞—Ç—å

### ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `aggregate_set_variable` –¥–ª—è:
- –ü—Ä–æ—Å—Ç—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å maxRecords=1
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ –º–æ–¥–µ–ª—è—Ö (–¥–∞–∂–µ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–ª—è–º–∏)
- –ë–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ maxRecords —á–µ—Ä–µ–∑ `aggregate_get_variable`

### ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `<<>>` –≤:
- `inputFormat` –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `aggregate_create_function`
- `outputFormat` –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `aggregate_create_function`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `<<>>` —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ `expression`

### ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `name` –≤:
- `aggregate_set_variable_field` - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `variableName`

### ‚ùå –ù–ï –∏–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ:
- –û—à–∏–±–∫–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ - –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –ó–∞–¥–µ—Ä–∂–∫–∏ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∞–≥–µ–Ω—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫—É maxRecords –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `aggregate_set_variable`

## üìñ –ë—ã—Å—Ç—Ä–∞—è —Å–ø—Ä–∞–≤–∫–∞

| –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã |
|------------------|------------|-----------|
| –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π | `aggregate_set_variable_field` | `variableName`, `fieldName`, `value` |
| –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–ª–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–ª—è–º–∏ | `aggregate_set_variable_field` | `variableName`, `fieldName`, `value` |
| –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Å maxRecords > 1 | `aggregate_set_variable` | `name`, `value` (DataTable) |
| –°–æ–∑–¥–∞—Ç—å Expression —Ñ—É–Ω–∫—Ü–∏—é | `aggregate_create_function` | `inputFormat` –ë–ï–ó `<<>>`, `expression` –° `<<>>` |
| –í—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ | `aggregate_call_function` | `parameters` (–æ–±—ä–µ–∫—Ç –∏–ª–∏ DataTable) |
| –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ –æ—Ç –∞–≥–µ–Ω—Ç–∞ | `aggregate_fire_event` | –ü–æ—Å–ª–µ –∑–∞–¥–µ—Ä–∂–∫–∏ 2-3 —Å–µ–∫—É–Ω–¥—ã |

---

**–í–µ—Ä—Å–∏—è:** 1.2  
**–î–∞—Ç–∞:** 2025-12-15

